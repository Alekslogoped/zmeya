<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Snake</title>

<style>
body{
  margin:0;
  background:#7bc96f;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

canvas{
  background:#8bd17c;
  border:8px solid #4c8f48;
  border-radius:16px;
}
</style>
</head>

<body>

<canvas id="game" width="480" height="360"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const grid = 20;
let count = 0;
let speed = 8;

let snake = {
  x:200,
  y:160,
  dx:grid,
  dy:0,
  cells:[],
  maxCells:5,
  mouth:0
};

let apple = {x:100,y:100};

function rand(){
  return Math.floor(Math.random()*20)*grid;
}

function newApple(){
  apple.x = rand();
  apple.y = rand();
}

function drawApple(){
  ctx.fillStyle="red";
  ctx.beginPath();
  ctx.arc(apple.x+10,apple.y+10,9,0,Math.PI*2);
  ctx.fill();

  ctx.fillStyle="green";
  ctx.fillRect(apple.x+9,apple.y-2,3,6);
}

function drawSnake(){
  snake.cells.forEach((cell,i)=>{

    ctx.fillStyle="#5d4037";
    ctx.fillRect(cell.x,cell.y,18,18);

    if(i===0){
      ctx.fillStyle="white";
      ctx.fillRect(cell.x+4,cell.y+4,4,4);
      ctx.fillRect(cell.x+10,cell.y+4,4,4);

      ctx.fillStyle="black";
      ctx.fillRect(cell.x+5,cell.y+5,2,2);
      ctx.fillRect(cell.x+11,cell.y+5,2,2);

      ctx.fillStyle="black";
      if(snake.mouth>0){
        ctx.fillRect(cell.x+6,cell.y+13,6,3);
        snake.mouth--;
      } else {
        ctx.fillRect(cell.x+7,cell.y+14,4,2);
      }
    }
  });
}

function loop(){
  requestAnimationFrame(loop);

  if(++count < speed) return;
  count = 0;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  snake.x += snake.dx;
  snake.y += snake.dy;

  if(snake.x<0) snake.x=canvas.width-grid;
  if(snake.x>=canvas.width) snake.x=0;
  if(snake.y<0) snake.y=canvas.height-grid;
  if(snake.y>=canvas.height) snake.y=0;

  snake.cells.unshift({x:snake.x,y:snake.y});

  if(snake.cells.length>snake.maxCells)
    snake.cells.pop();

  drawApple();
  drawSnake();

  if(snake.x===apple.x && snake.y===apple.y){
    snake.maxCells++;
    snake.mouth=5;
    newApple();
  }
}

document.addEventListener("keydown", e=>{
  if(e.key==="ArrowLeft" && snake.dx===0){
    snake.dx=-grid; snake.dy=0;
  }
  if(e.key==="ArrowRight" && snake.dx===0){
    snake.dx=grid; snake.dy=0;
  }
  if(e.key==="ArrowUp" && snake.dy===0){
    snake.dy=-grid; snake.dx=0;
  }
  if(e.key==="ArrowDown" && snake.dy===0){
    snake.dy=grid; snake.dx=0;
  }
});

newApple();
loop();
</script>

</body>
</html>
