<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Змейка</title>

<style>
body{
  margin:0;
  background:#7bc96f;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  font-family:sans-serif;
}

#wrap{
  position:relative;
  padding:12px;
  background:#5fae57;
  border-radius:20px;
  box-shadow:0 0 0 10px #4c8f48;
}

canvas{
  background:#7bc96f;
  border-radius:12px;
}

#ui{
  position:absolute;
  top:-40px;
  left:0;
  width:100%;
  display:flex;
  justify-content:space-between;
  color:white;
}
</style>
</head>

<body>

<div id="wrap">
  <div id="ui">
    <div>Счёт: <span id="score">0</span></div>
    <div>
      Скорость
      <input id="speed" type="range" min="5" max="15" value="9">
    </div>
  </div>

  <canvas id="game" width="480" height="360"></canvas>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const grid = 20;
let frameCount = 0;
let speed = 9;

document.getElementById("speed").oninput = e =>
  speed = 20 - e.target.value;

let snake = {
  x:200,
  y:160,
  dx:grid,
  dy:0,
  cells:[],
  maxCells:5,
  mouth:0
};

let apple = {x:100,y:100};
let score = 0;

function rand(){
  return Math.floor(Math.random()*20)*grid;
}

function newApple(){
  apple.x = rand();
  apple.y = rand();
}

function drawGrass(){
  ctx.strokeStyle="#5fae57";
  for(let i=0;i<40;i++){
    ctx.beginPath();
    ctx.moveTo(Math.random()*480,Math.random()*360);
    ctx.lineTo(Math.random()*480,Math.random()*360);
    ctx.stroke();
  }
}

function drawApple(){
  ctx.fillStyle="#d32f2f";
  ctx.beginPath();
  ctx.arc(apple.x+10, apple.y+10, 9, 0, Math.PI*2);
  ctx.fill();

  ctx.fillStyle="#2e7d32";
  ctx.fillRect(apple.x+9, apple.y-2, 3,6);
}

function drawSnake(){
  snake.cells.forEach((cell,i)=>{

    ctx.fillStyle="#6d4c41";
    ctx.beginPath();
    ctx.roundRect(cell.x,cell.y,18,18,6);
    ctx.fill();

    if(i===0){
      ctx.fillStyle="white";
      ctx.fillRect(cell.x+4,cell.y+4,4,4);
      ctx.fillRect(cell.x+10,cell.y+4,4,4);

      ctx.fillStyle="black";
      ctx.fillRect(cell.x+5,cell.y+5,2,2);
      ctx.fillRect(cell.x+11,cell.y+5,2,2);

      ctx.fillStyle="black";
      if(snake.mouth>0){
        ctx.fillRect(cell.x+6,cell.y+12,6,3);
        snake.mouth--;
      } else {
        ctx.fillRect(cell.x+7,cell.y+13,4,2);
      }
    }
  });
}

function loop(){
  requestAnimationFrame(loop);
  if(++frameCount < speed) return;
  frameCount = 0;

  ctx.clearRect(0,0,480,360);
  drawGrass();

  snake.x += snake.dx;
  snake.y += snake.dy;

  if(snake.x<0) snake.x=480-grid;
  if(snake.x>=480) snake.x=0;
  if(snake.y<0) snake.y=360-grid;
  if(snake.y>=360) snake.y=0;

  snake.cells.unshift({x:snake.x,y:snake.y});
  if(snake.cells.length>snake.maxCells)
    snake.cells.pop();

  drawApple();
  drawSnake();

  if(snake.x===apple.x && snake.y===apple.y){
    snake.maxCells++;
    snake.mouth = 6;
    score++;
    document.getElementById("score").textContent = score;
    newApple();
  }
}

document.addEventListener("keydown", e=>{
  if(e.key==="ArrowLeft" && snake.dx===0){
    snake.dx=-grid; snake.dy=0;
  }
  if(e.key==="ArrowRight" && snake.dx===0){
    snake.dx=grid; snake.dy=0;
  }
  if(e.key==="ArrowUp" && snake.dy===0){
    snake.dy=-grid; snake.dx=0;
  }
  if(e.key==="ArrowDown" && snake.dy===0){
    snake.dy=grid; snake.dx=0;
  }
});

newApple();
loop();
</script>

</body>
</html>

